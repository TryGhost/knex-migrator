#!/usr/bin/env node
'use strict';

const program = require('commander');
const utils = require('../lib/utils');
const logging = require('../lib/logging');

utils.getKnexMigrator({path: process.cwd()}).then(function (KnexMigrator) {
    let knexMigrator;

    program
        .option('--v <item>')
        .option('--only <item>')
        .option('--mgpath <path>')
        .option('--force')
        .option('--init')
        .parse(process.argv);

    try {
        knexMigrator = new KnexMigrator({knexMigratorFilePath: program.mgpath});
    } catch (err) {
        logging.error(err);
        process.exit(1);
    }

    return knexMigrator.migrate({
        version: program.v,
        only: program.only,
        force: program.force,
        init: program.init
    }).then(function () {
        logging.info('Finished database migration!');
    });
}).catch(function (err) {
    logging.error(err);
    process.exit(1);
});
