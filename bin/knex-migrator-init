#!/usr/bin/env node
'use strict';

const program = require('commander');
const utils = require('../lib/utils');
const logging = require('../lib/logging');

utils.getKnexMigrator({path: process.cwd()}).then(function (KnexMigrator) {
    let knexMigrator;

    program
        .option('--skip <item>')
        .option('--only <item>')
        .option('--mgpath <path>')
        .parse(process.argv);

    try {
        knexMigrator = new KnexMigrator({knexMigratorFilePath: program.mgpath});
    } catch (err) {
        logging.error(err);
        process.exit(1);
    }

    return knexMigrator.init({
        skip: program.skip,
        only: program.only
    }).then(function () {
        logging.info('Finished database init!');
    });
}).catch(function (err) {
    logging.error(err);
    process.exit(1);
});
